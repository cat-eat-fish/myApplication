(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/test/test"],{"185d":function(t,e,i){"use strict";var n=i("cb32"),s=i.n(n);s.a},"508b":function(t,e,i){"use strict";(function(t){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(t){i(this,e),a(this,"ctx",""),a(this,"canvasWidth",300),a(this,"canvasHeight",900),a(this,"linePrack",[]),a(this,"currentLine",[]),a(this,"transparent",1),a(this,"pressure",.5),a(this,"smoothness",100),a(this,"lineSize",1.5),a(this,"lineMin",.5),a(this,"lineMax",2),a(this,"currentPoint",{}),a(this,"firstTouch",!0),a(this,"radius",1),a(this,"cutArea",{top:0,right:0,bottom:0,left:0}),a(this,"lastPoint",0),a(this,"chirography",[]),a(this,"startY",0),a(this,"deltaY",0),a(this,"startValue",0),this.lineColor=t.lineColor||"#1A1A1A",this.slideValue=t.slideValue||50,this.canvasName=t.canvasName||"handWriting",this.init()}return s(e,[{key:"init",value:function(){var e=this;this.ctx=t.createCanvasContext(this.canvasName);var i=t.createSelectorQuery();i.select(".handCenter").boundingClientRect(function(t){e.canvasWidth=t.width,e.canvasHeight=t.height}).exec(),this.selectSlideValue(this.slideValue)}},{key:"uploadScaleStart",value:function(t){var e=t.mp;if("touchstart"!=e.type)return!1;this.ctx.setFillStyle(this.lineColor),this.ctx.setGlobalAlpha(this.transparent),this.currentPoint={x:e.touches[0].x,y:e.touches[0].y},this.currentLine.unshift({time:(new Date).getTime(),dis:0,x:this.currentPoint.x,y:this.currentPoint.y}),this.firstTouch&&(this.cutArea={top:this.currentPoint.y,right:this.currentPoint.x,bottom:this.currentPoint.y,left:this.currentPoint.x},this.firstTouch=!1),this.pointToLine(this.currentLine)}},{key:"uploadScaleMove",value:function(t){var e=t.mp;if("touchmove"!=e.type)return!1;e.cancelable&&(e.defaultPrevented||e.preventDefault());var i={x:e.touches[0].x,y:e.touches[0].y};i.y<this.cutArea.top&&(this.cutArea.top=i.y),i.y<0&&(this.cutArea.top=0),i.x>this.cutArea.right&&(this.cutArea.right=i.x),this.canvasWidth-i.x<=0&&(this.cutArea.right=this.canvasWidth),i.y>this.cutArea.bottom&&(this.cutArea.bottom=i.y),this.canvasHeight-i.y<=0&&(this.cutArea.bottom=this.canvasHeight),i.x<this.cutArea.left&&(this.cutArea.left=i.x),i.x<0&&(this.cutArea.left=0),this.lastPoint=this.currentPoint,this.currentPoint=i,this.currentLine.unshift({time:(new Date).getTime(),dis:this.distance(this.currentPoint,this.lastPoint,"move"),x:i.x,y:i.y}),this.pointToLine(this.currentLine)}},{key:"uploadScaleEnd",value:function(t){var e=t.mp;if("touchend"!=e.type)return 0;var i={x:e.changedTouches[0].x,y:e.changedTouches[0].y};if(this.lastPoint=this.currentPoint,this.currentPoint=i,this.currentLine.unshift({time:(new Date).getTime(),dis:this.distance(this.currentPoint,this.lastPoint,"end"),x:i.x,y:i.y}),this.currentLine.length>2)this.currentLine[0].time,this.currentLine[this.currentLine.length-1].time,this.currentLine.length;this.pointToLine(this.currentLine);var n={lineSize:this.lineSize,lineColor:this.lineColor};this.chirography.unshift(n),this.linePrack.unshift(this.currentLine),this.currentLine=[]}},{key:"retDraw",value:function(){this.ctx.clearRect(0,0,700,730),this.ctx.draw()}},{key:"pointToLine",value:function(t){this.calcBethelLine(t)}},{key:"calcBethelLine",value:function(t){if(t.length<=1)t[0].r=this.radius;else{var e,i,n,s,a,r,c,l,o,h,u=0,d=0,v=.5;t.length<=2?(e=t[1].x,s=t[1].y,n=t[1].x+(t[0].x-t[1].x)*v,r=t[1].y+(t[0].y-t[1].y)*v,i=e+(n-e)*v,a=s+(r-s)*v):(e=t[2].x+(t[1].x-t[2].x)*v,s=t[2].y+(t[1].y-t[2].y)*v,i=t[1].x,a=t[1].y,n=i+(t[0].x-i)*v,r=a+(t[0].y-a)*v),o=this.distance({x:n,y:r},{x:e,y:s},"calc"),h=this.radius;for(var f=0;f<t.length-1;f++)if(u+=t[f].dis,d+=t[f].time-t[f+1].time,u>this.smoothness)break;this.radius=Math.min(d/o*this.pressure+this.lineMin,this.lineMax)*this.lineSize,t[0].r=this.radius,t.length<=2?(c=(h+this.radius)/2,l=c,l):(c=(t[2].r+t[1].r)/2,l=t[1].r,(t[1].r+t[0].r)/2);for(var x=5,y=[],p=0;p<x;p++){var g=p/(x-1),m=(1-g)*(1-g)*e+2*g*(1-g)*i+g*g*n,b=(1-g)*(1-g)*s+2*g*(1-g)*a+g*g*r,C=h+(this.radius-h)/x*p;if(y.push({x:m,y:b,r:C}),3==y.length){var w=this.ctaCalc(y[0].x,y[0].y,y[0].r,y[1].x,y[1].y,y[1].r,y[2].x,y[2].y,y[2].r);w[0].color=this.lineColor,this.bethelDraw(w,1),y=[{x:m,y:b,r:C}]}}}}},{key:"distance",value:function(t,e,i){var n=e.x-t.x,s=e.y-t.y;return 5*Math.sqrt(n*n+s*s)}},{key:"ctaCalc",value:function(t,e,i,n,s,a,r,c,l){var o,h,u,d,v,f,x,y,p,g=[];o=n-t,h=s-e,u=2*Math.sqrt(o*o+h*h+1e-4),o=o/u*i,h=h/u*i,d=h,v=-o,f=n-r,x=s-c,u=2*Math.sqrt(f*f+x*x+1e-4),f=f/u*l,x=x/u*l,y=-x,p=f,g.push({mx:t+d,my:e+v,color:"#1A1A1A"}),g.push({c1x:n+d,c1y:s+v,c2x:n+y,c2y:s+p,ex:r+y,ey:c+p}),g.push({c1x:r+y-f,c1y:c+p-x,c2x:r-y-f,c2y:c-p-x,ex:r-y,ey:c-p}),g.push({c1x:n-y,c1y:s-p,c2x:n-d,c2y:s-v,ex:t-d,ey:e-v}),g.push({c1x:t-d-o,c1y:e-v-h,c2x:t+d-o,c2y:e+v-h,ex:t+d,ey:e+v}),g[0].mx=g[0].mx.toFixed(1),g[0].mx=parseFloat(g[0].mx),g[0].my=g[0].my.toFixed(1),g[0].my=parseFloat(g[0].my);for(var m=1;m<g.length;m++)g[m].c1x=g[m].c1x.toFixed(1),g[m].c1x=parseFloat(g[m].c1x),g[m].c1y=g[m].c1y.toFixed(1),g[m].c1y=parseFloat(g[m].c1y),g[m].c2x=g[m].c2x.toFixed(1),g[m].c2x=parseFloat(g[m].c2x),g[m].c2y=g[m].c2y.toFixed(1),g[m].c2y=parseFloat(g[m].c2y),g[m].ex=g[m].ex.toFixed(1),g[m].ex=parseFloat(g[m].ex),g[m].ey=g[m].ey.toFixed(1),g[m].ey=parseFloat(g[m].ey);return g}},{key:"bethelDraw",value:function(t,e,i){this.ctx.beginPath(),this.ctx.moveTo(t[0].mx,t[0].my),void 0!=i?(this.ctx.setFillStyle(i),this.ctx.setStrokeStyle(i)):(this.ctx.setFillStyle(t[0].color),this.ctx.setStrokeStyle(t[0].color));for(var n=1;n<t.length;n++)this.ctx.bezierCurveTo(t[n].c1x,t[n].c1y,t[n].c2x,t[n].c2y,t[n].ex,t[n].ey);this.ctx.stroke(),void 0!=e&&this.ctx.fill(),this.ctx.draw(!0)}},{key:"selectColorEvent",value:function(t){this.lineColor=t}},{key:"selectSlideValue",value:function(t){switch(t){case 0:this.lineSize=.1,this.lineMin=.1,this.lineMax=.1;break;case 25:this.lineSize=1,this.lineMin=.5,this.lineMax=2;break;case 50:this.lineSize=1.5,this.lineMin=1,this.lineMax=3;break;case 75:this.lineSize=1.5,this.lineMin=2,this.lineMax=3.5;break;case 100:this.lineSize=3,this.lineMin=2,this.lineMax=3.5;break}}},{key:"saveCanvas",value:function(){var e=this;return new Promise(function(i,n){t.canvasToTempFilePath({canvasId:e.canvasName,success:function(t){i(t.tempFilePath)},fail:function(t){console.log("图片生成失败："+t),n(t)}})})}}]),e}(),c=r;e.default=c}).call(this,i("6e42")["default"])},adbb:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"wrapper"},[t._m(0),i("view",{staticClass:"handBtn"},[i("view",{staticClass:"slide-wrapper"},[i("text",[t._v("选择粗细")]),i("slider",{staticClass:"slider",attrs:{value:"50","show-value":"",step:"25",eventid:"55e3695e-0"},on:{change:t.updateValue}})]),i("view",{staticClass:"color"},[i("text",[t._v("选择颜色")]),i("image",{staticClass:"black-select",class:"black"===t.selectColor?"color_select":"",attrs:{src:"black"===t.selectColor?"../../static/img/color_black_selected.png":"../../static/img/color_black.png",eventid:"55e3695e-1"},on:{click:function(e){t.selectColorEvent("black")}}}),i("image",{staticClass:"red-select",class:"red"===t.selectColor?"color_select":"",attrs:{src:"red"===t.selectColor?"../../static/img/color_red_selected.png":"../../static/img/color_red.png",eventid:"55e3695e-2"},on:{click:function(e){t.selectColorEvent("red")}}})])]),i("view",{staticClass:"handCenter"},[i("canvas",{staticClass:"handWriting",attrs:{"disable-scroll":"true","canvas-id":"handWriting",eventid:"55e3695e-3"},on:{touchstart:t.uploadScaleStart,touchmove:t.uploadScaleMove,touchend:t.uploadScaleEnd,tap:t.mouseDown}})]),i("view",{staticClass:"showimg"},[t.showimg?i("image",{attrs:{src:t.showimg,mode:""}}):i("text",[t._v("图片展示")])]),i("view",{staticClass:"buttons"},[i("button",{staticClass:"delBtn",attrs:{eventid:"55e3695e-4"},on:{click:t.retDraw}},[t._v("重写")]),i("button",{staticClass:"subBtn",attrs:{eventid:"55e3695e-5"},on:{click:t.subCanvas}},[t._v("保存")])],1)])},s=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"handRight"},[i("view",{staticClass:"handTitle"},[t._v("手写板")])])}];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return s})},c55d:function(t,e,i){"use strict";i.r(e);var n=i("adbb"),s=i("ffb9");for(var a in s)"default"!==a&&function(t){i.d(e,t,function(){return s[t]})}(a);i("185d");var r=i("2877"),c=Object(r["a"])(s["default"],n["a"],n["b"],!1,null,"4d420686",null);e["default"]=c.exports},cb32:function(t,e,i){},eb6e:function(t,e,i){"use strict";i("e716");var n=a(i("b0ce")),s=a(i("c55d"));function a(t){return t&&t.__esModule?t:{default:t}}Page((0,n.default)(s.default))},ef93:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i("508b"));function s(t){return t&&t.__esModule?t:{default:t}}var a={data:function(){return{lineColor:"black",slideValue:50,handwriting:"",selectColor:"black",color:"",showimg:"",share_popup:!1}},onLoad:function(){this.handwriting=new n.default({lineColor:this.lineColor,slideValue:this.slideValue,canvasName:"handWriting"})},methods:{selectColorEvent:function(t){this.selectColor=t,"black"==t?this.color="#1A1A1A":"red"==t&&(this.color="#ca262a"),this.handwriting.selectColorEvent(this.color)},retDraw:function(){this.handwriting.retDraw()},updateValue:function(t){console.log(t.detail),this.slideValue=t.detail.value,this.handwriting.selectSlideValue(this.slideValue)},uploadScaleStart:function(t){this.handwriting.uploadScaleStart(t)},uploadScaleMove:function(t){this.handwriting.uploadScaleMove(t)},uploadScaleEnd:function(t){this.handwriting.uploadScaleEnd(t)},subCanvas:function(){var t=this;this.handwriting.saveCanvas().then(function(e){t.showimg=e,console.log(e)}).catch(function(t){console.log(t)})}}};e.default=a},ffb9:function(t,e,i){"use strict";i.r(e);var n=i("ef93"),s=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);e["default"]=s.a}},[["eb6e","common/runtime","common/vendor"]]]);