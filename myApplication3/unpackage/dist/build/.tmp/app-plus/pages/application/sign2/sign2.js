(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/application/sign2/sign2"],{"195c":function(t,e,i){},"31f4":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c},a=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return a})},"3c53":function(module,exports,__webpack_require__){"use strict";(function(uni){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _index=__webpack_require__("db42"),_service=__webpack_require__("8938"),_config=__webpack_require__("43fa"),_util=__webpack_require__("f035"),cpimg=function(){return __webpack_require__.e("components/cpimg").then(__webpack_require__.bind(null,"8de9"))},_default={components:{cpimg:cpimg},data:function(){return{inNum:null,allInfo:[],allLoc:[],bankId:"",standTime:"",img:"",morning_clock_in:"",morning_clock_out:"",afternoon_clock_in:"",afternoon_clock_out:"",mapShow:!1,isTrue:null,signText:"",signstate:"",r:80,scale:"17",clickNum:0,latitude:"",longitude:"",accuracy:"",address:"我的位置",time:(0,_util.formateDate)(new Date,"h:min:s"),signInfo:{mode:"",latitude:"",longitude:"",address:"",time:"",remarks:""},covers:[],circles:[],controls:[{id:0,position:{left:280,top:260,width:32,height:32},iconPath:"../../../static/img/resetlo.png",clickable:!0}],showData:{standTime:"",clockTime:"",status:"",file:"",userId:(0,_service.getUserInfo)().userName,bankId:""}}},onLoad:function(t){this.getData(),this.getTime(),this.showData.standTime=this.standTime=t.standTime},methods:{getData:function(){var t=this,e="".concat((0,_config.baseIp)(),"/ams/system/distribute.htm?module=findAttendanceRules_YD&userId=").concat((0,_service.getUserInfo)().userName);uni.request({url:e,success:function(e){var i=e.data.object;t.allInfo=i,t.r=Number(i[0].clock_scope);var n=[];i.map(function(e,i){t.covers[i]={id:i,callout:{content:Number(e.address),display:"ALWAYS"},latitude:Number(e.latitude),longitude:Number(e.longitude),iconPath:"../../../static/img/location.png"},t.circles[i]={latitude:e.latitude,longitude:e.longitude,radius:Number(e.clock_scope),strokeWidth:1,fillColor:"#7fff0099"};var a=[];a.push(Number(e.latitude),Number(e.longitude)),n.push(a)}),t.allLoc=n.concat(),t.r=Number(i[0].clock_scope),t.getLocation(),t.morning_clock_in=i[0].morning_clock_in,t.morning_clock_out=i[0].morning_clock_out,t.afternoon_clock_in=i[0].afternoon_clock_in,t.afternoon_clock_out=i[0].afternoon_clock_out,t.showData.bankId=t.bankId=e.data.object[0].deptid,t.mapShow=!0}})},getTime:function(){var t=this;setInterval(function(){t.time=(0,_util.formateDate)(new Date,"h:min:s")},1e3)},cpimgOk:function(t){this.showData.file=this.img=t[0];var e=this;setTimeout(function(){e.handSign()},800)},handSign:function handSign(){uni.showLoading({title:"打卡记录中"});var url="".concat((0,_config.baseIp)(),"/ams/system/distribute.htm?module=workRecord_YD"),data={file:this.showData.file,userId:(0,_service.getUserInfo)().userName,bankId:this.showData.bankId,clockTime:(0,_util.formateDate)(new Date,"Y-M-D h:min:s"),standTime:this.showData.standTime,remark:this.signInfo.remarks,longitude:this.longitude,latitude:this.latitude,status:this.showData.status,clockPlace:this.signInfo.address};uni.request({url:url,method:"POST",data:data,success:function success(Res){uni.hideLoading();var data=Res.data;"string"==typeof data&&(data=eval("("+data+")")),"object"==typeof data&&(1==data.code?(uni.showToast({title:data.message,mask:!0,duration:3e3}),setTimeout(function(){uni.reLaunch({url:"/pages/tabBar/information/information"})},3e3)):uni.showToast({title:data.message,icon:"none",mask:!0,duration:3e3}))},fail:function(t){uni.hideLoading(),uni.showToast({title:t.errMsg,icon:"none"})}})},cpimgErr:function(t){console.log(t," at pages\\application\\sign2\\sign2.vue:204")},clickSign:function(){var t=this,e=this.is;if(null!==e){var i=18e5;if(this.standTime==this.morning_clock_in){var n=this.morning_clock_in,a=(new Date).getTime(),o=(0,_util.formateDate)(new Date,"Y-M-D")+" "+n;o=o.replace(/-/g,":").replace(" ",":"),o=o.split(":");var s=new Date(o[0],o[1]-1,o[2],o[3],o[4],o[5]),c=s.getTime(),r=(0,_util.formateDate)(new Date(c),"h:min"),u=(i=c-i,(0,_util.formateDate)(new Date(i),"h:min"));if(a<i)return void uni.showToast({title:"上午上班打卡时间范围为".concat(u," -- ").concat(r,"！"),icon:"none",mask:!0,duration:3e3})}else if(this.standTime==this.morning_clock_out)n=this.morning_clock_out;else if(this.standTime==this.afternoon_clock_in){n=this.afternoon_clock_in,a=(new Date).getTime(),o=(0,_util.formateDate)(new Date,"Y-M-D")+" "+n;o=o.replace(/-/g,":").replace(" ",":"),o=o.split(":");s=new Date(o[0],o[1]-1,o[2],o[3],o[4],o[5]),c=s.getTime(),r=(0,_util.formateDate)(new Date(c),"h:min"),i=c-i,u=(0,_util.formateDate)(new Date(i),"h:min");if(a<i)return void uni.showToast({title:"下午上班打卡时间范围为".concat(u," -- ").concat(r,"！"),icon:"none",mask:!0,duration:3e3})}else if(this.standTime==this.afternoon_clock_out)n=this.afternoon_clock_out;n=this.standTime;if(n==t.morning_clock_in)var l=t.compareDate(n.substr(0,5),(0,_util.formateDate)(new Date,"h:min"))?"00":"01";else if(n==t.morning_clock_out)l=t.compareDate(n.substr(0,5),(0,_util.formateDate)(new Date,"h:min"))?"02":"00";else if(n==t.afternoon_clock_in)l=t.compareDate(n.substr(0,5),(0,_util.formateDate)(new Date,"h:min"))?"00":"01";else if(n==t.afternoon_clock_out)l=t.compareDate(n.substr(0,5),(0,_util.formateDate)(new Date,"h:min"))?"02":"00";var d="正常打卡"===t.signInfo.mode?"00":"外勤打卡"==t.signInfo.mode?"03":"",m="".concat(l,",").concat(d);this.showData.standTime=n,this.showData.status=m,this.$refs.cpimgs._changImg()}else uni.showToast({title:"请检查位置信息状态！",icon:"none",mask:!0,duration:3e3})},doSign:function(){},getAdd:function(){if(!0!==this.isTrue){var t=this,e=_config.txKey,i="https://apis.map.qq.com/ws/geocoder/v1/?location=".concat(t.latitude,",").concat(t.longitude,"&key=").concat(e);uni.request({url:i,success:function(e){var i=e.data;if(0==i.status){if(!1===t.isTrue){var n=e.data.result.address+e.data.result.formatted_addresses.recommend;t.address=n,t.signInfo.address=n}}else uni.showToast({title:i.message,icon:"none"})}})}},controltap:function(t){this.getLocation()},getLocation:function(){var t=this;0!==this.clickNum&&uni.showLoading({title:"获取中...",mask:!0}),this.clickNum>=10?uni.showToast({title:"请稍后尝试！",icon:"none",mask:!0}):(this.clickNum++,uni.getLocation({type:"gcj02",success:function(e){uni.hideLoading(),t.accuracy=e.accuracy,t.latitude=e.latitude,t.longitude=e.longitude,t.scale=17;var i=t.covers.length;t.covers[1]={id:i,latitude:e.latitude,longitude:e.longitude,iconPath:"../../../static/img/location.png"};var n=t.allLoc.map(function(i,n){var a=[],o=(0,_util.pointInsideCircle)([e.latitude,e.longitude],[i[0],i[1]],t.r/1e5);if(o)return a[0]=o,a[1]=n,a});if(void 0===n[0])t.isTrue=!1,t.signInfo.mode=t.signText=t.signstate="外勤打卡";else{t.isTrue=!0,t.signInfo.mode=t.signText=t.signstate="正常打卡",t.inNum=n[0][1];var a=t.allInfo[n[0][1]].place_name;t.address=a,t.signInfo.address=a}t.signInfo.latitude=e.latitude,t.signInfo.longitude=e.longitude,t.getAdd()},fail:function(e){uni.hideLoading(),t.signText="请检查位置信息",uni.showToast({title:"请检查位置信息状态！",icon:"none",mask:!0,duration:3e3})}}))},compareDate:function(t,e){var i=Number(t.substr(0,2)),n=Number(t.substr(3)),a=Number(e.substr(0,2)),o=Number(e.substr(3));if(i>a)return!0;if(i<a)return!1;if(i==a){if(n>=o)return!0;if(n<o)return!1}},openLocation:function(){var t=this;uni.chooseLocation({success:function(e){t.address=e.address,t.signInfo.address=e.address;var i=(0,_util.pointInsideCircle)([t.latitude,t.longitude],[t.circles[0].latitude,t.circles[0].longitude],t.r/1e4);t.isTrue=i,t.signstate=i?"在考勤范围内":"不在考勤范围内",t.signText=i?"正常打卡":"外勤打卡"}})}}};exports.default=_default}).call(this,__webpack_require__("6e42")["default"])},"3e1b9":function(t,e,i){"use strict";i.r(e);var n=i("31f4"),a=i("7417");for(var o in a)"default"!==o&&function(t){i.d(e,t,function(){return a[t]})}(o);i("47b8");var s=i("2877"),c=Object(s["a"])(a["default"],n["a"],n["b"],!1,null,null,null);e["default"]=c.exports},"47b8":function(t,e,i){"use strict";var n=i("195c"),a=i.n(n);a.a},7417:function(t,e,i){"use strict";i.r(e);var n=i("3c53"),a=i.n(n);for(var o in n)"default"!==o&&function(t){i.d(e,t,function(){return n[t]})}(o);e["default"]=a.a}},[["d2e2","common/runtime","common/vendor"]]]);