(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/application/sign/sign"],{"305f":function(t,e,n){},"696c":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=(t._self._c,t.name.substr(-2));t.$mp.data=Object.assign({},{$root:{g0:n}})},a=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return a})},"6c56":function(t,e,n){"use strict";n.r(e);var i=n("696c"),a=n("ade0");for(var o in a)"default"!==o&&function(t){n.d(e,t,function(){return a[t]})}(o);n("92de");var s=n("2877"),c=Object(s["a"])(a["default"],i["a"],i["b"],!1,null,null,null);e["default"]=c.exports},"92de":function(t,e,n){"use strict";var i=n("305f"),a=n.n(i);a.a},ade0:function(t,e,n){"use strict";n.r(e);var i=n("f777"),a=n.n(i);for(var o in i)"default"!==o&&function(t){n.d(e,t,function(){return i[t]})}(o);e["default"]=a.a},f777:function(module,exports,__webpack_require__){"use strict";(function(uni){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _service=__webpack_require__("8938"),_config=__webpack_require__("43fa"),_util=__webpack_require__("f035"),_index=__webpack_require__("db42"),cpimg=function(){return __webpack_require__.e("components/cpimg").then(__webpack_require__.bind(null,"8de9"))},uniPopup=function(){return __webpack_require__.e("components/uni-popup/uni-popup").then(__webpack_require__.bind(null,"34a4"))},uniIcon=function(){return __webpack_require__.e("components/uni-icon/uni-icon").then(__webpack_require__.bind(null,"43d8"))},uniCollapse=function(){return __webpack_require__.e("components/uni-collapse/uni-collapse").then(__webpack_require__.bind(null,"58db"))},uniList=function(){return __webpack_require__.e("components/uni-list/uni-list").then(__webpack_require__.bind(null,"4bef"))},uniCollapseItem=function(){return __webpack_require__.e("components/uni-collapse-item/uni-collapse-item").then(__webpack_require__.bind(null,"9f13"))},_default={components:{uniCollapseItem:uniCollapseItem,uniList:uniList,uniCollapse:uniCollapse,uniIcon:uniIcon,uniPopup:uniPopup,cpimg:cpimg},data:function(){return{inNum:null,allInfo:[],allLoc:[],bankId:"",standTime:"",nowSign:0,name:(0,_service.getUserInfo)().name,bzText:{time:"",address:"",img:"",remarks:""},type:"",r:80,morning_clock_in:"",morning_clock_out:"",afternoon_clock_in:"",afternoon_clock_out:"",isAm:!1,isAmOut:!1,isPmIn:!1,isPm:!1,amSign:{clock_time:"",address:"",remarks:"",img:""},amOutSign:{clock_time:"",address:"",remarks:"",img:""},pmInSign:{clock_time:"",address:"",remarks:"",img:""},pmSign:{clock_time:"",address:"",remarks:"",img:""},clickNum:0,is:null,isSign:!1,time:(0,_util.formateDate)(new Date,"h:min:s"),date:(0,_util.formateDate)(new Date,"Y-M-D"),img:"",servetime:"",nowtime:"",showErr:!1,latitude:"",longitude:"",address:"我的位置",wqInfo:null,allSign:[],signInfo:{mode:"",latitude:"",longitude:"",address:"",time:"",remarks:""},showData:{standTime:"",clockTime:"",status:"",file:"",userId:(0,_service.getUserInfo)().userName,bankId:""}}},onLoad:function(){this.getTime(),this.getData()},methods:{doInfo:function(){var t=this;uni.showModal({title:"上传照片提示",content:"检测到您第一次打卡，请先拍照上传照片！",success:function(e){e.confirm?uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["camera"],success:function(e){var n=e.tempFilePaths[0];t.img=n;var i="".concat((0,_config.baseIp)(),"/ams/system/distribute.htm?module=saveBasicPhoto_YD&userId=").concat((0,_service.getUserInfo)().userName);uni.uploadFile({url:i,filePath:e.tempFilePaths[0],name:"file",success:function(t){var e=JSON.parse(t.data);uni.showToast({title:e.message,mask:!0})}})},fail:function(t){uni.navigateBack()}}):e.cancel&&uni.navigateBack()}})},togglePopup:function(t){this.type=t},goRule:function(){uni.navigateTo({url:"/pages/application/rule/rule"})},getAdd:function(){if(!(this.isAm&&this.isPm&&this.isAmOut&&this.isPmIn)&&!0!==this.is){var t=this,e=_config.txKey,n="https://apis.map.qq.com/ws/geocoder/v1/?location=".concat(t.latitude,",").concat(t.longitude,"&key=").concat(e);uni.request({url:n,success:function(e){var n=e.data;if(0==n.status){if(null===t.is&&(t.address="请检查位置信息！"),!1===t.is){var i=e.data.result.address+e.data.result.formatted_addresses.recommend;t.address=i,t.signInfo.address=i}}else uni.showToast({title:n.message,icon:"none"})}})}},getData:function(){var t=this,e="".concat((0,_config.baseIp)(),"/ams/system/distribute.htm?module=findAttendanceRules_YD&date=").concat(this.date,"&userId=").concat((0,_service.getUserInfo)().userName);uni.request({url:e,success:function(e){var n=300,i=Math.round(new Date/1e3),a=e.data.time,o=i+n,s=i-n,c=o>a&&s<a;if(!c){var u=a+"000";return t.servetime=(0,_util.formateDate)(new Date(Number(u)),"Y-M-D h:min:s"),t.nowtime=(0,_util.formateDate)(new Date,"Y-M-D h:min:s"),void(t.showErr=!0)}if(2==e.data.code)return uni.showToast({title:e.data.message,mask:!0,icon:"none",duration:3e3}),void setTimeout(function(){uni.navigateBack()},3e3);var r=e.data.object;t.allInfo=r;var m=[];if(r.map(function(t,e){var n=[];n.push(Number(t.latitude),Number(t.longitude)),m.push(n)}),t.allLoc=m.concat(),t.r=Number(r[0].clock_scope),t.getLocation(),t.morning_clock_in=r[0].morning_clock_in,t.morning_clock_out=r[0].morning_clock_out,t.afternoon_clock_in=r[0].afternoon_clock_in,t.afternoon_clock_out=r[0].afternoon_clock_out,t.showData.bankId=t.bankId=e.data.object[0].deptid,"0"==e.data.code1&&t.doInfo(),0==e.data.object2.length)return t.nowSign=0,t.isAm=!1,t.isAmOut=!1,t.isPmIn=!1,t.isPm=!1,t.amSign={},t.amOutSign={},t.pmInSign={},void(t.pmSign={});e.data.object2.map(function(t,e){var n=t.picture.indexOf("ams"),i=t.picture.substring(n);i=i.replace(/\\/g,"/"),t.picture="".concat((0,_config.baseIp)(),"/").concat(i)}),0!=e.data.object2.length&&e.data.object2.map(function(t,e){t.clock_time=t.clock_time.substring(10,16)}),1==e.data.object2.length?e.data.object2[0].stand_time==t.morning_clock_in?(t.isAm=!0,t.nowSign=1,t.amSign=e.data.object2[0]):e.data.object2[0].stand_time==t.morning_clock_out?(t.isAmOut=!0,t.nowSign=2,t.amOutSign=e.data.object2[0]):e.data.object2[0].stand_time==t.afternoon_clock_in?(t.isPmIn=!0,t.nowSign=3,t.pmInSign=e.data.object2[0]):e.data.object2[0].stand_time==t.afternoon_clock_out&&(t.isPm=!0,t.nowSign=4,t.pmSign=e.data.object2[0]):2==e.data.object2.length?e.data.object2[0].stand_time==t.morning_clock_in?(t.isAm=!0,t.amSign=e.data.object2[0],e.data.object2[1].stand_time==t.morning_clock_out&&(t.isAmOut=!0,t.amOutSign=e.data.object2[1],t.nowSign=2),e.data.object2[1].stand_time==t.afternoon_clock_in&&(t.isPmIn=!0,t.pmInSign=e.data.object2[1],t.nowSign=3),e.data.object2[1].stand_time==t.afternoon_clock_out&&(t.isPm=!0,t.pmSign=e.data.object2[1],t.nowSign=4)):e.data.object2[0].stand_time==t.morning_clock_out?(t.isAmOut=!0,t.amOutSign=e.data.object2[0],e.data.object2[1].stand_time==t.afternoon_clock_in&&(t.isPmIn=!0,t.pmInSign=e.data.object2[1],t.nowSign=3),e.data.object2[1].stand_time==t.afternoon_clock_out&&(t.isPm=!0,t.pmSign=e.data.object2[1],t.nowSign=4)):e.data.object2[0].stand_time==t.afternoon_clock_in&&(t.isPmIn=!0,t.pmInSign=e.data.object2[0],e.data.object2[1].stand_time==t.afternoon_clock_out&&(t.isPm=!0,t.pmSign=e.data.object2[1],t.nowSign=4)):3==e.data.object2.length?e.data.object2[0].stand_time==t.morning_clock_in?(t.isAm=!0,t.amSign=e.data.object2[0],e.data.object2[1].stand_time==t.morning_clock_out?(t.isAmOut=!0,t.amOutSign=e.data.object2[1],e.data.object2[2].stand_time==t.afternoon_clock_in&&(t.isPmIn=!0,t.nowSign=3,t.pmInSign=e.data.object2[2]),e.data.object2[2].stand_time==t.afternoon_clock_out&&(t.isPm=!0,t.nowSign=4,t.pmSign=e.data.object2[2])):e.data.object2[1].stand_time==t.afternoon_clock_in&&(t.isPmIn=!0,t.nowSign=3,t.pmInSign=e.data.object2[2],t.isPm=!0,t.nowSign=4,t.pmSign=e.data.object2[2])):e.data.object2[0].stand_time==t.morning_clock_out&&(t.isAmOut=!0,t.isPmIn=!0,t.isPm=!0,t.nowSign=4,t.amOutSign=e.data.object2[0],t.pmInSign=e.data.object2[1],t.pmSign=e.data.object2[2]):4==e.data.object2.length&&e.data.object2[0].stand_time==t.morning_clock_in&&(t.isAm=!0,t.isAmOut=!0,t.isPmIn=!0,t.isPm=!0,t.nowSign=4,t.amSign=e.data.object2[0],t.amOutSign=e.data.object2[1],t.pmInSign=e.data.object2[2],t.pmSign=e.data.object2[3])}})},getLocation:function(){var t=this;0!==this.clickNum&&uni.showLoading({title:"获取中...",mask:!0}),this.clickNum>=3?uni.showToast({title:"请稍后尝试！",icon:"none",mask:!0}):(this.clickNum++,uni.getLocation({type:"gcj02",success:function(e){uni.hideLoading(),t.latitude=e.latitude,t.longitude=e.longitude;var n=t.allLoc.map(function(n,i){var a=[],o=(0,_util.pointInsideCircle)([e.latitude,e.longitude],[n[0],n[1]],t.r/1e5);if(o)return a[0]=o,a[1]=i,a});if(void 0===n[0])t.is=!1,t.signInfo.mode="外勤打卡";else{t.is=!0,t.signInfo.mode="正常打卡",t.inNum=n[0][1];var i=t.allInfo[n[0][1]].place_name;t.address=i,t.signInfo.address=i}t.signInfo.latitude=e.latitude,t.signInfo.longitude=e.longitude,t.getAdd()},fail:function(e){uni.hideLoading(),t.address="请检查位置信息！",uni.showToast({title:"请检查位置信息状态！",icon:"none",mask:!0,duration:3e3})}}))},relocation:function(t){if("morning_clock_in"==t)var e=this.morning_clock_in;else if("morning_clock_out"==t)e=this.morning_clock_out;else if("afternoon_clock_in"==t)e=this.afternoon_clock_in;else if("afternoon_clock_out"==t)e=this.afternoon_clock_out;uni.navigateTo({url:"/pages/application/sign2/sign2?standTime=".concat(e)})},bindDateChange:function(t){var e=t.target.value;this.date=e,this.getData()},showBz:function(t){this.type="middle-list","amSign"==t&&(this.bzText.time=this.amSign.clock_time,this.bzText.address=this.amSign.clock_place,this.bzText.remarks=this.amSign.remark,this.bzText.img="".concat(this.amSign.picture)),"amOutSign"==t&&(this.bzText.time=this.amOutSign.clock_time,this.bzText.address=this.amOutSign.clock_place,this.bzText.remarks=this.amOutSign.remark,this.bzText.img="".concat(this.amOutSign.picture)),"pmInSign"==t&&(this.bzText.time=this.pmInSign.clock_time,this.bzText.address=this.pmInSign.clock_place,this.bzText.img="".concat(this.pmInSign.picture),this.bzText.remarks=this.pmInSign.remark),"pmSign"==t&&(this.bzText.time=this.pmSign.clock_time,this.bzText.address=this.pmSign.clock_place,this.bzText.remarks=this.pmSign.remark,this.bzText.img="".concat(this.pmSign.picture))},getTime:function(){var t=this;setInterval(function(){t.time=(0,_util.formateDate)(new Date,"h:min:s")},1e3)},cpimgOk:function(t){this.showData.file=this.img=t[0];var e=this;setTimeout(function(){e.handSign()},800)},handSign:function handSign(){uni.showLoading({title:"打卡记录中"});var url="".concat((0,_config.baseIp)(),"/ams/system/distribute.htm?module=workRecord_YD"),data={file:this.showData.file,userId:(0,_service.getUserInfo)().userName,bankId:this.showData.bankId,clockTime:(0,_util.formateDate)(new Date,"Y-M-D h:min:s"),standTime:this.showData.standTime,remark:this.signInfo.remarks,longitude:this.longitude,latitude:this.latitude,status:this.showData.status,clockPlace:this.signInfo.address};uni.request({url:url,method:"POST",data:data,success:function success(Res){uni.hideLoading();var data=Res.data;"string"==typeof data&&(data=eval("("+data+")")),"object"==typeof data&&(1==data.code?(uni.showToast({title:data.message,mask:!0,duration:3e3}),setTimeout(function(){uni.reLaunch({url:"/pages/tabBar/information/information"})},3e3)):uni.showToast({title:data.message,icon:"none",mask:!0,duration:3e3}))},fail:function(t){uni.hideLoading(),uni.showToast({title:t.errMsg,icon:"none"})}})},cpimgErr:function(t){console.log(t," at pages\\application\\sign\\sign.vue:906")},clickSign:function(t){var e=this,n=this.is;if(null!==n){var i=18e5;if("morning_clock_in"==t){var a=this.morning_clock_in,o=(new Date).getTime(),s=(0,_util.formateDate)(new Date,"Y-M-D")+" "+a;s=s.replace(/-/g,":").replace(" ",":"),s=s.split(":");var c=new Date(s[0],s[1]-1,s[2],s[3],s[4],s[5]),u=c.getTime(),r=(0,_util.formateDate)(new Date(u),"h:min"),m=(i=u-i,(0,_util.formateDate)(new Date(i),"h:min"));if(o<i)return void uni.showToast({title:"上午上班打卡时间范围为".concat(m," -- ").concat(r,"！"),icon:"none",mask:!0,duration:3e3})}else if("morning_clock_out"==t)a=this.morning_clock_out;else if("afternoon_clock_in"==t){a=this.afternoon_clock_in,o=(new Date).getTime(),s=(0,_util.formateDate)(new Date,"Y-M-D")+" "+a;s=s.replace(/-/g,":").replace(" ",":"),s=s.split(":");c=new Date(s[0],s[1]-1,s[2],s[3],s[4],s[5]),u=c.getTime(),r=(0,_util.formateDate)(new Date(u),"h:min"),i=u-i,m=(0,_util.formateDate)(new Date(i),"h:min");if(o<i)return void uni.showToast({title:"下午上班打卡时间范围为".concat(m," -- ").concat(r,"！"),icon:"none",mask:!0,duration:3e3})}else if("afternoon_clock_out"==t)a=this.afternoon_clock_out;if(a==e.morning_clock_in)var l=e.compareDate(a.substr(0,5),(0,_util.formateDate)(new Date,"h:min"))?"00":"01";else if(a==e.morning_clock_out)l=e.compareDate(a.substr(0,5),(0,_util.formateDate)(new Date,"h:min"))?"02":"00";else if(a==e.afternoon_clock_in)l=e.compareDate(a.substr(0,5),(0,_util.formateDate)(new Date,"h:min"))?"00":"01";else if(a==e.afternoon_clock_out)l=e.compareDate(a.substr(0,5),(0,_util.formateDate)(new Date,"h:min"))?"02":"00";var d="正常打卡"===e.signInfo.mode?"00":"外勤打卡"==e.signInfo.mode?"03":"",_="".concat(l,",").concat(d);this.showData.standTime=a,this.showData.status=_,this.$refs.cpimgs._changImg()}else uni.showToast({title:"请检查位置信息状态！",icon:"none",mask:!0,duration:3e3})},compareDate:function(t,e){var n=Number(t.substr(0,2)),i=Number(t.substr(3)),a=Number(e.substr(0,2)),o=Number(e.substr(3));if(n>a)return!0;if(n<a)return!1;if(n==a){if(i>=o)return!0;if(i<o)return!1}}}};exports.default=_default}).call(this,__webpack_require__("6e42")["default"])}},[["44c6","common/runtime","common/vendor"]]]);